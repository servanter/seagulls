<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.crop.seagulls.dao.UserDAO">

	<resultMap id="userMap" type="user">
		<result property="id" column="id" />
		<result property="nickName" column="nick_name" />
		<result property="realName" column="real_name" />
		<result property="phone" column="phone" />
		<result property="password" column="password" />
		<result property="provinceId" column="province_id" />
		<result property="cityId" column="city_id" />
		<result property="areaId" column="area_id" />
		<result property="headUrl" column="head_url" />
		<result property="identityId" column="identity_id" />
		<result property="isValid" column="is_valid" />
		<result property="createTime" column="create_Time" />
		<result property="updateTime" column="update_time" />
	</resultMap>

	<select id="isExistUser" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		SELECT COUNT(*) AS total FROM crop_user WHERE phone=#{phone}
	</select>

	<select id="getUserByNameAndPass" parameterType="user"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE phone = #{phone} AND password =
		#{password} AND is_valid = 1
	</select>

	<select id="getUserById" parameterType="java.lang.Long"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE id = #{id}
	</select>

	<select id="getUserByNick" parameterType="java.lang.String"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE user_nick like #{nickName}
	</select>

	<insert id="save" parameterType="user">
		INSERT INTO crop_user (phone, password, create_time) VALUES
		(#{phone},#{password}, #{createTime})
		<selectKey resultType="Long" keyProperty="id">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<update id="update" parameterType="user">
		UPDATE crop_user
		<set>
			<if test="password != null and password != '' ">password=#{password},</if>
			<if test="nickName != null and nickName != ''">nick_name=#{nickName},</if>
			<if test="realName != null and realName != ''">real_name=#{realName},</if>
			<if test="phone != null and phone != ''">phone=#{phone},</if>
			<if test="provinceId != null and provinceId > 0">province_id=#{provinceId},</if>
			<if test="cityId != null and cityId > 0">city_id=#{cityId},</if>
			<if test="areaId != null and areaId > 0">area_id=#{areaId},</if>
			<if test="headUrl != null and headUrl != ''">head_url=#{headUrl},</if>
			<if test="identityId != null">identity_id=#{identityId},</if>
			<if test="isValid != null">is_valid=#{isValid},</if>
		</set>
		WHERE id=#{id}
	</update>

	<select id="getUsersByIds" parameterType="java.lang.Long"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE id IN
		<foreach collection="array" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</select>
	
	<select id="findMaxId" resultType="long">
		SELECT MAX(id) FROM crop_user
	</select>

</mapper>
