<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.crop.seagulls.dao.UserDAO">

	<resultMap id="userMap" type="user">
		<result property="id" column="id" />
	</resultMap>


	<select id="isExistUser" parameterType="java.lang.String"
		resultType="java.lang.Integer">
		SELECT COUNT(*) AS total FROM crop_user WHERE phone=#{phone}
	</select>

	<select id="getUserByNameAndPass" parameterType="user"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE phone = #{phone} AND password =
		#{password} AND is_valid = 1
	</select>

	<select id="getUserById" parameterType="java.lang.Long"
		resultMap="userMap">
		SELECT * FROM user WHERE id = #{id}
	</select>

	<select id="getUserByNick" parameterType="java.lang.String"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE user_nick like #{nickName}
	</select>

	<insert id="save" parameterType="user">
		INSERT INTO crop_user (phone,password, create_time) VALUES
		(#{phone},#{password}, #{createTime})
		<selectKey resultType="Long" keyProperty="id">
			SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<update id="update" parameterType="user">
		UPDATE crop_user
		<set>
			<if test="passWord != null">pass_word=#{passWord},</if>
			<if test="sex != null">sex=#{sex},</if>
			<if test="userNick != null">user_nick=#{userNick},</if>
			<if test="userImg != null">user_img=#{userImg},</if>
			<if test="birthday != null">birthday=#{birthday},</if>
			<if test="province != null">province=#{province},</if>
			<if test="city != null">city=#{city},</if>
			<if test="introduction != null">
				introduction=#{introduction},
			</if>
			<if test="mobile != null">mobile=#{mobile},</if>
			<if test="email != null">email=#{email},</if>
			<if test="isValid != null">is_valid=#{isValid},</if>
			<if test="isIndex != null">is_index=#{isIndex},</if>
		</set>
		WHERE id=#{id}
	</update>

	<select id="getUsersByIds" parameterType="java.lang.Long"
		resultMap="userMap">
		SELECT * FROM crop_user WHERE id IN
		<foreach collection="array" item="id" open="(" separator=","
			close=")">
			#{id}
		</foreach>
	</select>

</mapper>
